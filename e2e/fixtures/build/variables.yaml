# Variable substitution test - validates package variables and custom vars
package:
  name: var-test
  version: 2.3.4
  epoch: 5

vars:
  custom-var: custom-value
  another-var: another-value

pipeline:
  - runs: |
      mkdir -p "${{targets.destdir}}/usr/share/var-test"

      cat > "${{targets.destdir}}/usr/share/var-test/package-vars.txt" << EOF
      name=${{package.name}}
      version=${{package.version}}
      epoch=${{package.epoch}}
      full-version=${{package.full-version}}
      EOF

      cat > "${{targets.destdir}}/usr/share/var-test/custom-vars.txt" << EOF
      custom-var=${{vars.custom-var}}
      another-var=${{vars.another-var}}
      EOF

test:
  pipeline:
    - runs: |
        grep -q "name=var-test" /usr/share/var-test/package-vars.txt
        grep -q "version=2.3.4" /usr/share/var-test/package-vars.txt
        grep -q "epoch=5" /usr/share/var-test/package-vars.txt
        grep -q "custom-var=custom-value" /usr/share/var-test/custom-vars.txt
        grep -q "another-var=another-value" /usr/share/var-test/custom-vars.txt
