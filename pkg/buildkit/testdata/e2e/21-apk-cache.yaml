package:
  name: apk-cache-test
  version: 1.0.0
  epoch: 0
  description: Test APK package cache mount path

environment:
  contents:
    packages:
      - busybox

pipeline:
  - name: Test APK cache path
    runs: |
      # Verify APK cache directory is writable and persists
      # The cache mount is at /var/cache/apk - BuildKit creates this when the cache is mounted
      # We don't need mkdir -p since the cache mount handles directory creation

      # Write build marker (cache mount makes this writable even for non-root user)
      echo "build-$BUILD_ID" >> /var/cache/apk/.build-marker.txt

      # Copy results to output
      mkdir -p ${{targets.destdir}}/usr/share/apk-cache-test
      cp /var/cache/apk/.build-marker.txt ${{targets.destdir}}/usr/share/apk-cache-test/builds.txt
      wc -l < /var/cache/apk/.build-marker.txt > ${{targets.destdir}}/usr/share/apk-cache-test/count.txt
