package:
  name: shell-ops-test
  version: 1.0.0
  epoch: 0
  description: Test advanced shell operations in pipelines
  copyright:
    - license: MIT

pipeline:
  - name: setup
    runs: |
      mkdir -p ${{targets.destdir}}/usr/share/shell-test

  - name: test-loops
    runs: |
      # Test for loop
      for i in 1 2 3 4 5; do
        echo "iteration $i" >> ${{targets.destdir}}/usr/share/shell-test/loop.txt
      done

  - name: test-conditionals
    runs: |
      # Test if/else
      VALUE="test"
      if [ "$VALUE" = "test" ]; then
        echo "condition passed" > ${{targets.destdir}}/usr/share/shell-test/conditional.txt
      else
        echo "condition failed" > ${{targets.destdir}}/usr/share/shell-test/conditional.txt
      fi

  - name: test-pipes
    runs: |
      # Test pipes and command substitution
      echo "line1
      line2
      line3" | wc -l | tr -d ' ' > ${{targets.destdir}}/usr/share/shell-test/pipes.txt

  - name: verify-results
    runs: |
      # Verify all operations succeeded
      test -s ${{targets.destdir}}/usr/share/shell-test/loop.txt || exit 1
      grep -q "iteration 5" ${{targets.destdir}}/usr/share/shell-test/loop.txt || exit 1
      grep -q "condition passed" ${{targets.destdir}}/usr/share/shell-test/conditional.txt || exit 1
      echo "shell operations successful" > ${{targets.destdir}}/usr/share/shell-test/status.txt
