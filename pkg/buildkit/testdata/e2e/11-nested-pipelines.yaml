package:
  name: nested-test
  version: 1.0.0
  epoch: 0
  description: Test nested pipeline execution
  copyright:
    - license: MIT

pipeline:
  - name: setup
    runs: |
      mkdir -p /home/build/melange-out/nested-test/usr/share/nested-test

  - name: outer-pipeline
    runs: |
      echo "outer-start" >> /home/build/melange-out/nested-test/usr/share/nested-test/order.txt
    pipeline:
      - name: inner-1
        runs: |
          echo "inner-1" >> /home/build/melange-out/nested-test/usr/share/nested-test/order.txt
        pipeline:
          - name: deeply-nested
            runs: |
              echo "deeply-nested" >> /home/build/melange-out/nested-test/usr/share/nested-test/order.txt
      - name: inner-2
        runs: |
          echo "inner-2" >> /home/build/melange-out/nested-test/usr/share/nested-test/order.txt

  - name: after-nested
    runs: |
      echo "after-nested" >> /home/build/melange-out/nested-test/usr/share/nested-test/order.txt
      # Count total lines to verify all ran
      wc -l < /home/build/melange-out/nested-test/usr/share/nested-test/order.txt > /home/build/melange-out/nested-test/usr/share/nested-test/count.txt
