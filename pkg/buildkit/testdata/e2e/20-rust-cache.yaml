package:
  name: rust-cache-test
  version: 1.0.0
  epoch: 0
  description: Test Rust cargo cache mount paths

environment:
  contents:
    packages:
      - busybox

pipeline:
  - name: Test Cargo cache paths
    runs: |
      # Verify Cargo cache directories are writable and persist
      # Use /home/build paths since builds run as build user (UID 1000)
      mkdir -p /home/build/.cargo/registry
      mkdir -p /home/build/.cargo/git

      # Write build markers
      echo "build-$BUILD_ID" >> /home/build/.cargo/registry/.build-marker.txt
      echo "build-$BUILD_ID" >> /home/build/.cargo/git/.build-marker.txt

      # Copy results to output
      mkdir -p ${{targets.destdir}}/usr/share/rust-cache-test
      cp /home/build/.cargo/registry/.build-marker.txt ${{targets.destdir}}/usr/share/rust-cache-test/registry-builds.txt
      cp /home/build/.cargo/git/.build-marker.txt ${{targets.destdir}}/usr/share/rust-cache-test/git-builds.txt
      wc -l < /home/build/.cargo/registry/.build-marker.txt > ${{targets.destdir}}/usr/share/rust-cache-test/registry-count.txt
      wc -l < /home/build/.cargo/git/.build-marker.txt > ${{targets.destdir}}/usr/share/rust-cache-test/git-count.txt
