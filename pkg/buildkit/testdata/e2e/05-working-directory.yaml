package:
  name: workdir-test
  version: 1.0.0
  epoch: 0
  description: Test working directory handling
  copyright:
    - license: MIT

pipeline:
  - name: setup-source
    runs: |
      # Create a source directory structure
      mkdir -p /home/build/src/project
      echo "source file 1" > /home/build/src/project/file1.txt
      echo "source file 2" > /home/build/src/project/file2.txt
      mkdir -p /home/build/src/project/subdir
      echo "nested file" > /home/build/src/project/subdir/nested.txt

  - name: build-in-subdir
    working-directory: /home/build/src/project
    runs: |
      # Verify we're in the right directory
      pwd > /tmp/workdir.txt

      # Work with files using relative paths
      cat file1.txt > /tmp/combined.txt
      cat file2.txt >> /tmp/combined.txt
      cat subdir/nested.txt >> /tmp/combined.txt

  - name: install-results
    runs: |
      mkdir -p ${{targets.destdir}}/usr/share/workdir-test

      # Copy the working directory output
      cp /tmp/workdir.txt ${{targets.destdir}}/usr/share/workdir-test/
      cp /tmp/combined.txt ${{targets.destdir}}/usr/share/workdir-test/
