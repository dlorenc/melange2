package:
  name: multi-pipeline-test
  version: 1.0.0
  epoch: 0
  description: Test multiple pipeline steps in sequence
  copyright:
    - license: MIT

pipeline:
  - name: step-1-setup
    runs: |
      mkdir -p /home/build/work
      echo "step1" > /home/build/work/progress.txt

  - name: step-2-process
    runs: |
      # This step depends on step-1 output
      echo "step2" >> /home/build/work/progress.txt
      cat /home/build/work/progress.txt | wc -l > /home/build/work/count.txt

  - name: step-3-validate
    runs: |
      # Validate previous steps completed
      echo "step3" >> /home/build/work/progress.txt

      # Count should be 2 at this point
      count=$(cat /home/build/work/count.txt)
      if [ "$count" != "2" ]; then
        echo "Expected count 2, got $count"
        exit 1
      fi

  - name: step-4-build
    runs: |
      echo "step4" >> /home/build/work/progress.txt

      # Create output directory
      mkdir -p ${{targets.destdir}}/usr/share/multi-pipeline

  - name: step-5-install
    runs: |
      echo "step5" >> /home/build/work/progress.txt

      # Install final output
      cp /home/build/work/progress.txt ${{targets.destdir}}/usr/share/multi-pipeline/
      cp /home/build/work/count.txt ${{targets.destdir}}/usr/share/multi-pipeline/
