package:
  name: assertion-test
  version: 1.0.0
  epoch: 0
  description: Test script assertions and command chaining
  copyright:
    - license: MIT

pipeline:
  - name: setup
    runs: |
      mkdir -p ${{targets.destdir}}/usr/share/assertion-test

  - name: test-assertions
    runs: |
      # Test file creation and verification
      echo "test content" > ${{targets.destdir}}/usr/share/assertion-test/test.txt
      test -f ${{targets.destdir}}/usr/share/assertion-test/test.txt

      # Test directory creation
      mkdir -p ${{targets.destdir}}/usr/share/assertion-test/subdir
      test -d ${{targets.destdir}}/usr/share/assertion-test/subdir

      # Test command chaining with &&
      echo "chain1" > ${{targets.destdir}}/usr/share/assertion-test/chain1.txt && \
      echo "chain2" > ${{targets.destdir}}/usr/share/assertion-test/chain2.txt && \
      echo "chain3" > ${{targets.destdir}}/usr/share/assertion-test/chain3.txt

      # Test variable in script
      MY_VAR="my-value"
      echo "$MY_VAR" > ${{targets.destdir}}/usr/share/assertion-test/var.txt

  - name: verify-results
    runs: |
      # Verify all files exist
      for f in test.txt chain1.txt chain2.txt chain3.txt var.txt; do
        test -f "${{targets.destdir}}/usr/share/assertion-test/$f" || exit 1
      done
      echo "all assertions passed" > ${{targets.destdir}}/usr/share/assertion-test/passed.txt
