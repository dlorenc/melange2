package:
  name: env-test
  version: 1.0.0
  epoch: 0
  description: Test environment variable handling
  copyright:
    - license: MIT

environment:
  contents:
    packages: []
  environment:
    CUSTOM_VAR: custom-env-value
    BUILD_TYPE: release
    PREFIX: /usr

pipeline:
  - name: test-global-env
    runs: |
      mkdir -p ${{targets.destdir}}/usr/share/env-test

      # Test global environment variables
      echo "CUSTOM_VAR=$CUSTOM_VAR" > ${{targets.destdir}}/usr/share/env-test/global-env.txt
      echo "BUILD_TYPE=$BUILD_TYPE" >> ${{targets.destdir}}/usr/share/env-test/global-env.txt
      echo "PREFIX=$PREFIX" >> ${{targets.destdir}}/usr/share/env-test/global-env.txt

  - name: test-pipeline-env
    environment:
      PIPELINE_VAR: pipeline-specific-value
      BUILD_TYPE: debug
    runs: |
      # Test pipeline-level environment override
      echo "PIPELINE_VAR=$PIPELINE_VAR" > ${{targets.destdir}}/usr/share/env-test/pipeline-env.txt
      echo "BUILD_TYPE=$BUILD_TYPE" >> ${{targets.destdir}}/usr/share/env-test/pipeline-env.txt

  - name: verify-home
    runs: |
      # Verify HOME is set correctly
      echo "HOME=$HOME" > ${{targets.destdir}}/usr/share/env-test/home.txt
