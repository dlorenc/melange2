package:
  name: subpkg-test
  version: 1.0.0
  epoch: 0
  description: Test basic subpackage handling
  copyright:
    - license: MIT

pipeline:
  - name: install-main
    runs: |
      mkdir -p ${{targets.destdir}}/usr/bin
      mkdir -p ${{targets.destdir}}/usr/lib
      mkdir -p ${{targets.destdir}}/usr/include
      mkdir -p ${{targets.destdir}}/usr/share/doc/subpkg-test

      # Main package binary
      echo '#!/bin/sh' > ${{targets.destdir}}/usr/bin/subpkg-main
      echo 'echo "main package"' >> ${{targets.destdir}}/usr/bin/subpkg-main
      chmod +x ${{targets.destdir}}/usr/bin/subpkg-main

      # Library (will go to -libs)
      echo "library content" > ${{targets.destdir}}/usr/lib/libsubpkg.so.1.0.0
      ln -s libsubpkg.so.1.0.0 ${{targets.destdir}}/usr/lib/libsubpkg.so.1
      ln -s libsubpkg.so.1 ${{targets.destdir}}/usr/lib/libsubpkg.so

      # Header (will go to -dev)
      echo "#ifndef SUBPKG_H" > ${{targets.destdir}}/usr/include/subpkg.h
      echo "#define SUBPKG_H" >> ${{targets.destdir}}/usr/include/subpkg.h
      echo "#endif" >> ${{targets.destdir}}/usr/include/subpkg.h

      # Static library (will go to -dev)
      echo "static lib" > ${{targets.destdir}}/usr/lib/libsubpkg.a

      # Documentation (will go to -doc)
      echo "# subpkg-test documentation" > ${{targets.destdir}}/usr/share/doc/subpkg-test/README.md

subpackages:
  - name: subpkg-test-dev
    description: Development files for subpkg-test
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/lib
          mkdir -p ${{targets.subpkgdir}}/usr/include

          # Move headers
          mv ${{targets.destdir}}/usr/include/* ${{targets.subpkgdir}}/usr/include/

          # Move static library
          mv ${{targets.destdir}}/usr/lib/*.a ${{targets.subpkgdir}}/usr/lib/

          # Move .so symlink (not versioned .so.*)
          mv ${{targets.destdir}}/usr/lib/libsubpkg.so ${{targets.subpkgdir}}/usr/lib/

  - name: subpkg-test-libs
    description: Shared libraries for subpkg-test
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/lib

          # Move versioned shared libraries
          mv ${{targets.destdir}}/usr/lib/libsubpkg.so.* ${{targets.subpkgdir}}/usr/lib/

  - name: subpkg-test-doc
    description: Documentation for subpkg-test
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/share/doc

          # Move documentation
          mv ${{targets.destdir}}/usr/share/doc/* ${{targets.subpkgdir}}/usr/share/doc/
