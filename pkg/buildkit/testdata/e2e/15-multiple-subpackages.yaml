package:
  name: multi-subpkg
  version: 2.0.0
  epoch: 1
  description: Test multiple subpackages with different pipeline types
  copyright:
    - license: Apache-2.0

pipeline:
  - name: build-main
    runs: |
      mkdir -p ${{targets.destdir}}/usr/bin
      mkdir -p ${{targets.destdir}}/usr/lib
      mkdir -p ${{targets.destdir}}/usr/include
      mkdir -p ${{targets.destdir}}/usr/share/doc/${{package.name}}

      # Main binary
      echo '#!/bin/sh' > ${{targets.destdir}}/usr/bin/multi-app
      echo 'echo "multi-app v${{package.version}}"' >> ${{targets.destdir}}/usr/bin/multi-app
      chmod +x ${{targets.destdir}}/usr/bin/multi-app

      # Library
      echo "library code" > ${{targets.destdir}}/usr/lib/libmulti.so.2.0.0

      # Headers
      echo "#define MULTI_H 1" > ${{targets.destdir}}/usr/include/multi.h

      # Documentation
      echo "# Multi-app Documentation" > ${{targets.destdir}}/usr/share/doc/${{package.name}}/README.md

subpackages:
  - name: multi-subpkg-dev
    description: Development files for multi-subpkg
    pipeline:
      - runs: |
          # Create dev subpackage output directory
          mkdir -p /home/build/melange-out/multi-subpkg-dev/usr
          echo "dev package marker" > /home/build/melange-out/multi-subpkg-dev/usr/dev-marker.txt

  - name: multi-subpkg-doc
    description: Documentation for multi-subpkg
    pipeline:
      - runs: |
          # Create doc subpackage output directory
          mkdir -p /home/build/melange-out/multi-subpkg-doc/usr/share
          echo "doc package marker" > /home/build/melange-out/multi-subpkg-doc/usr/share/doc-marker.txt

  - name: multi-subpkg-libs
    description: Shared libraries for multi-subpkg
    pipeline:
      - runs: |
          # Create libs subpackage output directory
          mkdir -p /home/build/melange-out/multi-subpkg-libs/usr/lib
          echo "libs package marker" > /home/build/melange-out/multi-subpkg-libs/usr/lib/libs-marker.txt
